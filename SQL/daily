SELECT DISTINCT
    sta.capacity,
    me.amount,
    dr.ongrid_energy,
    mr.month_ongrid_energy,
    yr.year_ongrid_energy,
    mr.month_ongrid_energy / me.amount `completion`,
    dr.purchased_energy,
    mr.month_purchased_energy,
    yr.year_purchased_energy,
    dr.obliquee_exposure,
    mr.month_obliquee_exposure,
    yr.year_obliquee_exposure,
    dr.obliquee_exposure / 3.6,
    mr.month_obliquee_exposure / 3.6,
    yr.year_obliquee_exposure / 3.6,
    dr.ongrid_energy / sta.capacity / dr.obliquee_exposure * 36,
    mr.month_ongrid_energy / sta.capacity / mr.month_obliquee_exposure * 36,
    yr.year_ongrid_energy / sta.capacity / yr.year_obliquee_exposure * 36
FROM
    stations sta
LEFT JOIN (
    SELECT
        pe.amount,
        pe.station_id
    FROM
        pms_energyplannings pe
    WHERE
        pe.`status` = 1
    AND pe.type = '上网电量'
    AND pe.`year` = '2019'
    AND pe.`month` = '2'
) me ON me.station_id = sta.id
LEFT JOIN (
    SELECT
        pdpr.station_id,
        pdpr.ongrid_energy ongrid_energy,
        pdpr.purchased_energy purchased_energy,
        pdpr.obliquee_exposure obliquee_exposure
    FROM
        pms_dailyproductionreports pdpr
    WHERE
        pdpr.ori_id != 0
    AND pdpr.`status` = 1
    AND pdpr.report_date = '2019-02-21'
) dr ON dr.station_id = sta.id
LEFT JOIN (
    SELECT
        pdm.station_id,
        DATE_FORMAT(pdm.report_date, '%Y-%m') report_month,
        SUM(pdm.ongrid_energy) month_ongrid_energy,
        SUM(pdm.purchased_energy) month_purchased_energy,
        SUM(pdm.obliquee_exposure) month_obliquee_exposure
    FROM
        pms_dailyproductionreports pdm
    WHERE
        pdm.ori_id != 0
    AND pdm.`status` = 1
    AND pdm.report_date <= '2019-02-21'
    AND DATE_FORMAT(pdm.report_date, '%Y-%m') = '2019-02'
    GROUP BY
        report_month,
        station_id
) mr ON mr.station_id = sta.id
LEFT JOIN (
    SELECT
        pdy.station_id,
        DATE_FORMAT(pdy.report_date, '%Y') report_year,
        SUM(pdy.ongrid_energy) year_ongrid_energy,
        SUM(pdy.purchased_energy) year_purchased_energy,
        SUM(pdy.obliquee_exposure) year_obliquee_exposure
    FROM
        pms_dailyproductionreports pdy
    WHERE
        pdy.ori_id != 0
    AND pdy.`status` = 1
    AND pdy.report_date <= '2019-02-21'
    AND DATE_FORMAT(pdy.report_date, '%Y') = '2019'
    GROUP BY
        report_year,
        station_id
) yr ON yr.station_id = sta.id
WHERE
    sta.`status` = 1
AND sta.id = 1